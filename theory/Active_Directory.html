<!--
title: Active Directory
description: 
published: true
date: 2025-03-07T10:38:04.753Z
tags: 
editor: ckeditor
dateCreated: 2025-01-15T12:03:06.610Z
-->

<h1><span class="text-small"><strong>Службы каталогов Active Directory (AD)</strong></span></h1>
<p><strong>Службы Active Directory (AD)</strong> - решение от компании Microsoft позволяющее объединить различные объекты сети (компьютеры, сервера, принтера, различные сервисы) в единую систему. В данном случае AD выступают в роли каталога (базы данных), в котором хранится информация о пользователях, ПК, серверах, сетевых и периферийных устройствах.</p>
<p><strong>LDAP (Lightweight Directory Access Protocol)</strong> – облегчённый протокол доступа к каталогам, открытый стандартизированный протокол, применяемый для работы с различным реализациям служб каталогов, в том числе и Active Directory. Для работы протокола LDAP по умолчанию используется TCP-порт 389.</p>
<p>Для реализации данного решения, необходим специальный сервер - контроллер домена. Именно он будет выполнять функции аутентификации пользователей и устройств в сети, а также выступать в качестве хранилища базы данных. При попытке использовать любой из объектов (ПК, сервер, принтер) сети, выполняется обращение к контроллеру домена, который либо разрешает это действие (есть необходимые права), либо блокирует его.</p>
<p><strong>Возможности</strong></p>
<p>Active Directory — предоставляет широкий спектр удобств для администрирования домена.</p>
<p>Домен (не путать с доменным именем) — это логическая структура, которая объединяет компьютеры, пользователей и ресурсы в единую управляемую единицу. Он служит для упрощения администрирования (управления сетевыми ресурсами).</p>
<p>Вот основные возможности AD:</p>
<ul>
  <li>Единая точка аутентификации</li>
</ul>
<p>Поскольку контроллер домена Active Directory хранит всю информацию об инфраструктуре и пользователях, вы легко можете использовать его для входа систему. Так, все данные пользователей (логины и пароли) хранятся в единой базе данных, что существенно упрощает работу с ними. При авторизации все компьютеры обращаются к этой базе данных, благодаря чему вносимые изменения будут применены ко всем компьютерам сети. Также с помощью AD реализуются политики безопасности, благодаря котором можно ограничить (либо разрешить) доступ к определенным серверам.</p>
<ul>
  <li>Удобное управление политиками</li>
</ul>
<p>С помощью Active Directory можно поделить компьютеры на различные рабочие группы (организационные подразделения). Это существенно упрощает использование инфраструктуры в двух случаях:</p>
<ol>
  <li>Изменение существующих настроек группы. Поскольку настройки хранятся в единой базе данных, при их модификации, они будут применены для всех компьютеров, относящихся к этой группе.</li>
  <li>Добавление нового пользователя. Он автоматически получает установленные для его группы настройки, что существенно ускоряет создание новой учетной записи.</li>
</ol>
<p>В зависимости от пользователя (учетной записи, которая используется) и его группы можно ввести ограничение на использование функционала операционной системы. Например, вы можете ограничить установку приложений всем кроме администраторов.</p>
<ul>
  <li>Безопасность</li>
</ul>
<p>Службы Active Directory существенно увеличивают защиту корпоративной сети. Так, все данные (учетные записи) хранятся на контроллерах доступа, которые защищены от внешнего доступа. Кроме того, для аутентификации в AD используется протокол Kerberos (протокол для взаимной аутентификации клиента и сервера перед установкой соединения, в нем учтена перехвата и модификации пакетов, что повышает его надежность), который значительно безопаснее аналога в рабочих группах.</p>
<ul>
  <li>Удобный обмен файлами</li>
</ul>
<p>С помощью AD достаточно легко реализуется технология Distributed File System (DFS), которая используется для управления файлами. Фактически, это распределенная сеть для хранения файлов - физически они располагаются на нескольких серверах, но логически находятся в одном месте. Это удобная функция, позволяющая масштабировать существующую инфраструктуру, добавляя новые сервера, а не заменяя ими старые.</p>
<ul>
  <li>Интеграция сервисов и оборудования</li>
</ul>
<p>Службы Active Directory позволяют организовать все оборудование и сервисы в единую систему. Например, присутствует поддержка стандарта LDAP (протокол для доступа к службе каталогов X.500), который позволяет работать с почтовыми и прокси серверами (Exchange Server и ISA Server соответственно). Поддерживаются не только продукты Microsoft, но и сторонние решения:</p>
<ol>
  <li>IP-телефония;</li>
  <li>1С;</li>
  <li>шлюз удаленных рабочих столов (Remote Desktop Gateway).</li>
</ol>
<p>Стоит отметить, возможность интеграции с Windows Server используя протокол RADIUS. Благодаря которому можно использовать VPN подключение для работы вне офиса.</p>
<h2><span class="text-small"><strong>Особенности Active Directory</strong></span></h2>
<p>Active Directory является центральным узлом инфраструктуры предприятия, поэтому в случае его отказа все ПК и сервера будут недоступны. Поэтому можно выделить несколько основных пунктов, позволяющих обеспечить бесперебойное круглосуточное функционирование системы.</p>
<p><strong>Наличие дублирующего контроллера доменов</strong></p>
<p>Вся база данных хранится на контроллере доменов Active Directory, поэтому при его отказе, вся система будет недоступна. Для обеспечения отказоустойчивости следует развернуть 1 или более дублирующих контроллеров доменов и настроить автоматическую репликацию всех изменений. В данном случае, при выходе из строя одного из контроллеров работоспособность сети не нарушается, ведь оставшиеся продолжают работать.</p>
<p><strong>Регулярные бэкапы</strong></p>
<p>Надежная система резервного копирования позволяет быстро восстановить работоспособность сервера. При использовании одного контроллера доменов резервное копирование не позволяет избежать простоя, но значительно снижает временные затраты на восстановление сервера.</p>
<p>Отличным решением будет использование и резервного копирования, и дублирующего контроллера доменов. В It-lite используется оба решения, что позволяет гарантировать высокую надежность системы.</p>
<h2><span class="text-small"><strong>Структура Active Directory</strong></span></h2>
<p><strong>Что такое леса, деревья и домены в Active Directory?</strong></p>
<p>Основными структурными элементами Active Directory являются:</p>
<ul>
  <li>домен – группа объектов (пользователей, компьютеров и пр.), основная административная единица AD. Для каждого домена настраиваются правила доступа к нему и политики взаимодействия с другими доменами (отношения доверия);</li>
  <li>структурное подразделение – необязательный наименьший возможный контейнер, в который при желании можно сгруппировать объекты домена (другие контейнеры, аккаунты пользователей и компьютеров). Могут использоваться, чтобы определить групповые политики и административный доступ для небольшой совокупности ресурсов в пределах одного домена;</li>
  <li>дерево доменов – коллекция доменов, сгруппированных в иерархическую структуру и имеющих связанное пространство имён;</li>
  <li>лес – контейнер высшего уровня, включающий в себя все домены каждого конкретного экземпляра AD.</li>
</ul>
<p>Таким образом, в иерархии Active Directory должен быть как минимум один лес, одно дерево и один домен.</p>
<p>Для каждого домена настраивается минимум один сервер с ролью контроллер домена, на котором работают сервисы AD. Он хранит информацию об объектах своего домена, и реализует операции поиска в каталоге, входа пользователей и проверки подлинности.</p>
<p>Контроллер домена, который содержит данные о каждом объекте в лесу AD, называется глобальный каталог. Он хранит полный набор атрибутов объектов своего домена и частичную реплику основных атрибутов (список которых можно настроить) объектов всех остальных доменов. Это позволяет быстро находить информацию независимо от её физического расположения на различных доменах.</p>
<p>В лесу обязательно должен быть минимум один глобальный каталог. По умолчанию им назначается первый контроллер домена, на который устанавливается роль доменных служб Active Directory.</p>
<p>Для связи с глобальным каталогом используется TCP-порт <strong>3268</strong> или <strong>3269</strong> при работе по протоколу LDAP и LDAPS соответственно.</p>
<h2><span class="text-small"><strong>Как работает Active Directory?</strong></span></h2>
<p>Сервисы Active Directory являются частью операционной системы Microsoft Windows Server и устанавливаются в качестве одной или нескольких её ролей.</p>
<p>Основной из них является роль доменные службы Active Directory (Active Directory Domain Services, AD DS) – она используется для организации в защищённую логическую структуру всех объектов сети. Полученная иерархическая схема является независимой от физического расположения объектов и топологии сети. Это значительно упрощает администрирование и настройку доступа, например, изменение физического расположения компьютера не повлияет на его роль в структуре AD.</p>
<p>Основными операциями при работе с Active Directory являются аутентификация пользователей, а также поиск, модификация и сравнение объектов. Эти функции реализуются с помощью протокола LDAP.</p>
<p>Active Directory содержит:</p>
<ul>
  <li>хранилище данных – часть службы каталогов, которая управляет хранением и предоставлением информации на каждом контроллере домена. Данные хранятся в структурированной базе данных (БД), которая иначе называется каталог и содержит совокупность всех объектов AD. Каждый из них относится к определённому классу (пользователи, компьютеры, домены и т.д.). В свою очередь, все объекты каждого класса имеют одинаковый набор атрибутов;</li>
  <li>схему – совокупность определений классов и атрибутов (именованных параметров) объектов. Она стандартизирует как данные хранятся в хранилище и благодаря этому позволяет получать информацию (как сказано выше, используется для этого протокол LDAP);</li>
  <li>леса, деревья, домены и организационные подразделения – ключевые элементы логической структуры AD, которые были подробно рассмотрены ранее.</li>
</ul>
<figure class="image"><img src="/ssa/windows/theoretical/ad_scheme.png"></figure>
<p>Для конвертации зарегистрированных в структуре Active Directory имён сетевых ресурсов (компьютеров, принтеров и пр.) в IP-адреса используется интеграция с DNS (Domain Name System, системой доменных имён). Это позволяет, например, пользователям получить доступ к компьютерам, а компьютерам – к контроллерам доменов.</p>
